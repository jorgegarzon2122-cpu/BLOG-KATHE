<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blog Floral</title>
  <style>
    :root{
      --cream: #f7f1e9;
      --rose: #f3b4c7;
      --lavender: #b7a6e1;
      --peach: #f6c27a;
      --leaf: #6fa56f;
      --text: #3a3a3a;
      --card: rgba(255,255,255,0.94);
      --border: #e8c4d6;
    }

    body{
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background-color: var(--cream);
      background-image: url('diseno-bordes-bodas-acuarela_23-2151179956.avif');
      background-repeat: no-repeat;
      background-size: cover;
      background-position: center;
      color: var(--text);
      margin: 0;
      padding: 30px 20px 80px;
    }

    header {
      background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(255,255,255,0.9));
      backdrop-filter: blur(4px);
      padding: 22px;
      text-align: center;
      border-bottom: 3px solid var(--border);
      border-radius: 12px;
      max-width: 900px;
      margin: 0 auto 18px;
    }

    h1 { color: #8a3f61; margin: 0; font-size: 2.2rem; font-weight: 700; }

    .container { max-width: 900px; margin: 18px auto; background: var(--card); padding: 18px; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); border: 1px solid var(--border); }

    label{display:block;margin-top:8px;color:var(--leaf);font-weight:600}

    input, textarea { width: 100%; padding: 12px; margin-top: 8px; border: 2px solid rgba(167,128,147,0.35); border-radius: 10px; outline: none; font-size: 15px; background: #fff; color: var(--text); }
    textarea { height: 140px; resize: vertical; }

    .btn { background: var(--rose); color: white; padding: 10px 16px; border: none; border-radius: 10px; cursor: pointer; margin-top: 12px; font-size: 15px; transition: .16s; }
    .btn:hover{ background: #e892b0 }

    .post { background: linear-gradient(180deg,#ffffff,#fffaf9); padding: 18px; margin-top: 18px; border-radius: 12px; border: 1px solid var(--border); }

    .post-title { font-size: 1.4rem; margin-bottom: 6px; color:#8a3f61; font-weight:700 }
    .date { color: #7a6c6c; font-size: .9rem; margin-bottom: 8px }
    .post img { max-width:100%; display:block; margin-top:10px; border-radius:10px; border:1px solid var(--border) }

    .post-footer{ margin-top:12px; display:flex; gap:8px; flex-wrap:wrap }
    .btn-small{ padding:8px 12px; font-size:14px; border-radius:8px }

    @media (max-width:640px){ body{ padding:18px; } header{ padding:14px; } }
  </style>
</head>
<body>
  <header>
    <h1>ðŸŒ¸ Blog Floral ðŸŒ¸</h1>
  </header>

  <div class="container" id="editor">
    <h2>Crear nueva entrada</h2>
    <label for="titleInput">TÃ­tulo</label>
    <input id="titleInput" placeholder="TÃ­tulo de la entrada" />
    <label for="contentInput">Contenido</label>
    <textarea id="contentInput" placeholder="Contenido..."></textarea>
    <label for="imageInput">Imagen (opcional, max 2 MB)</label>
    <input id="imageInput" type="file" accept="image/*" />
    <button class="btn" id="publishBtn">Publicar</button>
    <div style="margin-top:10px;color:#6b705c;font-size:13px">
      La imagen de fondo usa: <code>diseno-bordes-bodas-acuarela_23-2151179956.avif</code>. Coloca ese archivo en la misma carpeta que este HTML.
    </div>
  </div>

  <div class="container" id="postsContainer"></div>

  <script type="module">
  // Firebase CDN imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyClNq5xfMuRpegRKntdtQeFFa-GyPnsUAc",
    authDomain: "blog-kathe.firebaseapp.com",
    projectId: "blog-kathe",
    storageBucket: "blog-kathe.firebasestorage.app",
    messagingSenderId: "250193338842",
    appId: "1:250193338842:web:e140bdb9c897944fcfe0e3",
    measurementId: "G-2MSFW2C966"
  };

  // Init Firebase & Firestore
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const postsRef = collection(db, "posts");

  const form = document.getElementById('postForm');
  const titleInput = document.getElementById('title');
  const contentInput = document.getElementById('content');
  const postsEl = document.getElementById('posts');
  const countEl = document.getElementById('count');
  const searchInput = document.getElementById('search');
  const clearSearchBtn = document.getElementById('clearSearch');
  const cancelEditBtn = document.getElementById('cancelEdit');

  let posts = []; // Firestore data
  let editingId = null;

  async function loadPosts(){
    posts = [];
    const snap = await getDocs(postsRef);
    snap.forEach(docu =>{
      posts.push({ id: docu.id, ...docu.data() });
    });
    renderPosts();
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }
  function nl2br(s){ return s.replace(/\n/g,'<br>'); }

  function renderPosts(filter=''){
    postsEl.innerHTML = '';
    const q = filter.trim().toLowerCase();
    const filtered = posts.filter(p => !q || p.title.toLowerCase().includes(q) || p.content.toLowerCase().includes(q));
    countEl.textContent = filtered.length;

    if(filtered.length === 0){ postsEl.innerHTML = '<div class="small">No hay entradas.</div>'; return; }

    filtered.slice().reverse().forEach(p =>{
      const node = document.createElement('article');
      node.className = 'post card';
      node.innerHTML = `
        <h3>${escapeHtml(p.title)}</h3>
        <div class="meta">${p.createdAt}</div>
        <div class="body">${nl2br(escapeHtml(p.content))}</div>
        <div class="controls">
          <button data-id="${p.id}" class="editBtn ghost">Editar</button>
          <button data-id="${p.id}" class="deleteBtn ghost">Eliminar</button>
        </div>`;
      postsEl.appendChild(node);
    });
    attachHandlers();
  }

  function attachHandlers(){
    document.querySelectorAll('.editBtn').forEach(btn => btn.onclick = handleEdit);
    document.querySelectorAll('.deleteBtn').forEach(btn => btn.onclick = handleDelete);
  }

  function handleEdit(e){
    const id = e.target.dataset.id;
    const p = posts.find(x => x.id === id);
    editingId = id;
    titleInput.value = p.title;
    contentInput.value = p.content;
    cancelEditBtn.style.display = 'inline-block';
    window.scrollTo({ top:0, behavior:'smooth' });
  }

  async function handleDelete(e){
    const id = e.target.dataset.id;
    await deleteDoc(doc(db, "posts", id));
    await loadPosts();
  }

  form.onsubmit = async (ev)=>{
    ev.preventDefault();
    const title = titleInput.value.trim();
    const content = contentInput.value.trim();
    if(!title || !content) return alert("Todos los campos son obligatorios");

    if(editingId){
      await updateDoc(doc(db, "posts", editingId), {
        title, content,
        updatedAt: new Date().toLocaleString()
      });
      editingId = null;
      cancelEditBtn.style.display = 'none';
    } else {
      await addDoc(postsRef, {
        title, content,
        createdAt: new Date().toLocaleString(),
        updatedAt: new Date().toLocaleString()
      });
    }

    form.reset();
    await loadPosts();
  };

  searchInput.oninput = ()=> renderPosts(searchInput.value);
  clearSearchBtn.onclick = ()=>{ searchInput.value=''; renderPosts(); };
  cancelEditBtn.onclick = ()=>{ editingId=null; form.reset(); cancelEditBtn.style.display='none'; };

  loadPosts();
</script>
</body>
</html>
